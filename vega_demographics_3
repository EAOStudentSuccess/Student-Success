
               
{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "autosize": "pad",
  "padding":5,
    
  
   "title": {
    "text": {"signal": "'Number of Students Across All Grades 2018/19'"},
    "anchor": "start",
    "frame": "bounds",
     "fontSize": 19,
     "dy":-30,
     "dx":0,
     "color":"blue"
   },
  "style": "cell",
  "data": [
    {"name": "highlight_store"},
    {
      "name": "source_0",
      "values": 
[{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"KF","TOTAL":575986,"MSK_FNL":"39909","MSK_FNL2":"39909","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":39909},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"01","TOTAL":575986,"MSK_FNL":"40360","MSK_FNL2":"40360","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":40360},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"02","TOTAL":575986,"MSK_FNL":"40842","MSK_FNL2":"40842","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":40842},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"03","TOTAL":575986,"MSK_FNL":"41042","MSK_FNL2":"41042","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":41042},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"04","TOTAL":575986,"MSK_FNL":"41201","MSK_FNL2":"41201","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":41201},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"05","TOTAL":575986,"MSK_FNL":"42683","MSK_FNL2":"42683","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":42683},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"06","TOTAL":575986,"MSK_FNL":"42796","MSK_FNL2":"42796","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":42796},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"07","TOTAL":575986,"MSK_FNL":"43033","MSK_FNL2":"43033","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":43033},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"08","TOTAL":575986,"MSK_FNL":"42464","MSK_FNL2":"42464","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":42464},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"09","TOTAL":575986,"MSK_FNL":"42934","MSK_FNL2":"42934","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":42934},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"10","TOTAL":575986,"MSK_FNL":"45340","MSK_FNL2":"45340","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":45340},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"11","TOTAL":575986,"MSK_FNL":"46867","MSK_FNL2":"46867","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":46867},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"12","TOTAL":575986,"MSK_FNL":"54262","MSK_FNL2":"54262","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":54262},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"All Students","grade":"Others","TOTAL":575986,"MSK_FNL":"12253","MSK_FNL2":"12253","pct_all":"100%","pct_total_subpop":"100%","ALL_STD":12253},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"KF","TOTAL":67668,"MSK_FNL":"3910","MSK_FNL2":"3910","pct_all":"10%","pct_total_subpop":"12%","ALL_STD":39909},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"01","TOTAL":67668,"MSK_FNL":"4387","MSK_FNL2":"4387","pct_all":"11%","pct_total_subpop":"12%","ALL_STD":40360},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"02","TOTAL":67668,"MSK_FNL":"4425","MSK_FNL2":"4425","pct_all":"11%","pct_total_subpop":"12%","ALL_STD":40842},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"03","TOTAL":67668,"MSK_FNL":"4741","MSK_FNL2":"4741","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":41042},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"04","TOTAL":67668,"MSK_FNL":"4991","MSK_FNL2":"4991","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":41201},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"05","TOTAL":67668,"MSK_FNL":"5196","MSK_FNL2":"5196","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":42683},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"06","TOTAL":67668,"MSK_FNL":"5409","MSK_FNL2":"5409","pct_all":"13%","pct_total_subpop":"12%","ALL_STD":42796},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"07","TOTAL":67668,"MSK_FNL":"5487","MSK_FNL2":"5487","pct_all":"13%","pct_total_subpop":"12%","ALL_STD":43033},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"08","TOTAL":67668,"MSK_FNL":"5467","MSK_FNL2":"5467","pct_all":"13%","pct_total_subpop":"12%","ALL_STD":42464},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"09","TOTAL":67668,"MSK_FNL":"5379","MSK_FNL2":"5379","pct_all":"13%","pct_total_subpop":"12%","ALL_STD":42934},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"10","TOTAL":67668,"MSK_FNL":"5511","MSK_FNL2":"5511","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":45340},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"11","TOTAL":67668,"MSK_FNL":"5594","MSK_FNL2":"5594","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":46867},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"12","TOTAL":67668,"MSK_FNL":"6446","MSK_FNL2":"6446","pct_all":"12%","pct_total_subpop":"12%","ALL_STD":54262},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Indigenous","grade":"Others","TOTAL":67668,"MSK_FNL":"725","MSK_FNL2":"725","pct_all":"6%","pct_total_subpop":"12%","ALL_STD":12253},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"KF","TOTAL":68236,"MSK_FNL":"1602","MSK_FNL2":"1602","pct_all":"4%","pct_total_subpop":"12%","ALL_STD":39909},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"01","TOTAL":68236,"MSK_FNL":"2211","MSK_FNL2":"2211","pct_all":"5%","pct_total_subpop":"12%","ALL_STD":40360},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"02","TOTAL":68236,"MSK_FNL":"2798","MSK_FNL2":"2798","pct_all":"7%","pct_total_subpop":"12%","ALL_STD":40842},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"03","TOTAL":68236,"MSK_FNL":"3409","MSK_FNL2":"3409","pct_all":"8%","pct_total_subpop":"12%","ALL_STD":41042},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"04","TOTAL":68236,"MSK_FNL":"4622","MSK_FNL2":"4622","pct_all":"11%","pct_total_subpop":"12%","ALL_STD":41201},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"05","TOTAL":68236,"MSK_FNL":"5752","MSK_FNL2":"5752","pct_all":"13%","pct_total_subpop":"12%","ALL_STD":42683},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"06","TOTAL":68236,"MSK_FNL":"6301","MSK_FNL2":"6301","pct_all":"15%","pct_total_subpop":"12%","ALL_STD":42796},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"07","TOTAL":68236,"MSK_FNL":"6819","MSK_FNL2":"6819","pct_all":"16%","pct_total_subpop":"12%","ALL_STD":43033},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"08","TOTAL":68236,"MSK_FNL":"6628","MSK_FNL2":"6628","pct_all":"16%","pct_total_subpop":"12%","ALL_STD":42464},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"09","TOTAL":68236,"MSK_FNL":"6715","MSK_FNL2":"6715","pct_all":"16%","pct_total_subpop":"12%","ALL_STD":42934},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"10","TOTAL":68236,"MSK_FNL":"6816","MSK_FNL2":"6816","pct_all":"15%","pct_total_subpop":"12%","ALL_STD":45340},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"11","TOTAL":68236,"MSK_FNL":"6807","MSK_FNL2":"6807","pct_all":"15%","pct_total_subpop":"12%","ALL_STD":46867},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"12","TOTAL":68236,"MSK_FNL":"7367","MSK_FNL2":"7367","pct_all":"14%","pct_total_subpop":"12%","ALL_STD":54262},{"district_name":"PROVINCE","SD":"099","year":"2019/2020","SUBPOP":"Special Needs","grade":"Others","TOTAL":68236,"MSK_FNL":"389","MSK_FNL2":"389","pct_all":"3%","pct_total_subpop":"12%","ALL_STD":12253}]
     
    },
    {
      "name": "data_0",
      "source": "source_0"
    },
    {
      "name": "data_1",
      "source": "data_0",
      
     "transform": [
        {"type": "formula", "as": "MSK_FNL", "expr": "format(datum.MSK_FNL,',.0f')"},
        {"type": "formula", "as": "TOTAL", "expr": "format(datum.TOTAL,',.0f')"},
        {"type":"filter", "expr":"datum.MSK_FNL !== 'MSK'"}
        
        ]
    
    },
        {
                      "name": "tot",
                      "source": "data_1",
                      "transform": [{"type":"filter", "expr":"datum.grade == '10'"}]
                    }
    
 
  ],
  "signals": [
    { "name": "fields",
      "value": ["01", "02", "03","04","05", "06", "07","08","09", "10", "11","12","KF","others"] },
    {"name": "x_step", "value": 65},
    {"name": "width", "update": "bandspace(domain('x').length, 0, 0) * x_step"},
    {"name": "y_step", "value": 60},
    {
      "name": "height",
      "update": "bandspace(domain('y').length, 0, 0) * y_step"
    },
    {
      "name": "unit",
      "value": {},
      "on": [
        {"events": "mousemove", "update": "isTuple(group()) ? group() : unit"}
      ]
    },
    {"name": "highlight", "update": "vlSelectionResolve(\"highlight_store\")"},
    {
      "name": "highlight_tuple",
      "on": [
        {
          "events": [{"source": "scope", "type": "click"}],
          "update": "datum && item().mark.marktype !== 'group' ? {unit: \"layer_0\", fields: highlight_tuple_fields, values: [(item().isVoronoi ? datum.datum : datum)[\"_vgsid_\"]]} : null",
          "force": true
        },
        {"events": [{"source": "scope", "type": "dblclick"}], "update": "null"}
      ]
    },
    {
      "name": "highlight_tuple_fields",
      "value": [{"type": "E", "field": "_vgsid_"}]
    },
    {
      "name": "highlight_modify",
      "update": "modify(\"highlight_store\", highlight_tuple, true)"
    },
     {"name": "palette", "value": "Oranges",
      "bind": {
        "input": "select",
        "options": [
          "YellowGreenBlue",
          "Viridis",
          "Magma",
          "Inferno",
          "Plasma",
          "DarkBlue",
          "DarkGold",
          "DarkGreen",
          "DarkMulti",
          "DarkRed",
          "LightGreyRed",
          "LightGreyTeal",
          "LightMulti",
          "LightOrange",
          "LightTealBlue",
          "Blues",
          "Browns",
          "Greens",
          "Greys",
          "Oranges",
          "Purples",
          "Reds",
          "TealBlues",
          "Teals",
          "WarmGreys",
          "BlueOrange",
          "BrownBlueGreen",
          "PurpleGreen",
          "PinkYellowGreen",
          "PurpleOrange",
          "RedBlue",
          "RedGrey",
          "RedYellowBlue",
          "RedYellowGreen",
          "BlueGreen",
          "BluePurple",
          "GoldGreen",
          "GoldOrange",
          "GoldRed",
          "GreenBlue",
          "OrangeRed",
          "PurpleBlueGreen",
          "PurpleBlue",
          "PurpleRed",
          "RedPurple",
          "YellowGreenBlue",
          "YellowGreen",
          "YellowOrangeBrown",
          "YellowOrangeRed"
        ]
      }}
  ],
  "marks": [
    {
      "name": "layer_0_marks",
      "type": "rect",
      "style": ["rect"],
      "from": {"data": "source_0"},
      "encode": {
        "enter": {"tooltip": {"signal": "{'District':datum.district_name,'Student Group':datum.SUBPOP,'% of all students in grade':datum.pct_all,'Records':datum.records}"}},
        "update": {
          "strokeWidth": {"value": 2},
          
          "fill": {"scale": "fill", "field": "MSK_FNL"},
          "stroke": [
            {
              "test": "(!(length(data(\"highlight_store\"))) || (vlSelectionTest(\"highlight_store\", datum))) && (length(data(\"highlight_store\")))",
              "value": "black"
            },
            {"value": null}
          ],
          "Description":"Delete below chunk",
        
          "x": {"scale": "x", "field": "grade"},
          "width": {"scale": "x", "band": true},
          "y": {"scale": "y", "field": "SUBPOP"},
          "height": {"scale": "y", "band": true},
          "stroke": {"value": null},
          "zindex": {"value": 0}
        },
          "hover": {
                                                                        "stroke": {"value": "black"},
                                                                        "zindex": {"value": 3}
                                                                      }
      }
      },
    {
      "name": "layer_1_marks",
      "type": "text",
      "style": ["text"],
      "from": {"data": "data_1"},
       "interactive": false,
       
      "encode": {
        "enter": {"fontSize":{"value":15}
        },
        "update": {
           "fill": [
            {"test": "datum['MSK_FNL'] =='0'", "MSK_FNL":""},
            {"value": "#555555"}
          ],
          "x": {"scale": "x", "field": "grade", "band": 0.5},
          "y": {"scale": "y", "field": "SUBPOP", "band": 0.5},
          "text": {"signal": "''+datum[\"MSK_FNL\"]"},
          "align": {"value": "center"},
          "baseline": {"value": "middle"}
        },
        "hover": {"name":"layer_0_marks",
                                                                        "stroke": {"value": "black"},
                                                                        "zindex": {"value": 3}
                                                                      }
      }
    },

        {
      "name": "layer_1",
      "type": "text",
      "style": ["text"],
      "from": {"data": "source_0"},
       "interactive": false,
       
      "encode": {
        "enter": {"fontSize":{"value":15}
        },
        "update": {
           "fill": [
            {"test": "datum['MSK_FNL2'] !=='MSK'", "value": ""},
            {"value": "#555555"}
          ],
          "x": {"scale": "x", "field": "grade", "band": 0.5},
          "y": {"scale": "y", "field": "SUBPOP", "band": 0.5},
          "text": {"signal": "''+datum[\"MSK_FNL2\"]"},
          "align": {"value": "center"},
          "baseline": {"value": "middle"}
        },
        "hover": {"name":"layer_0_marks",
                                                                        "stroke": {"value": "black"},
                                                                        "zindex": {"value": 3}
                                                                      }
      }
    },
  {
                                         "type": "group",
                                      "from": {
                                        "facet": {
                                          "data": "tot",
                                          "name": "rec",
                                          "groupby": "SUBPOP"
                                        }
                                      },

                                      "encode": {
                                        "enter": {
                                          "x": {"scale": "x", "field": "grade", "band": 0.5},
                                          "y": {"scale": "y", "field": "SUBPOP", "band": 0.5}
                                        }
                                      },

                                      "data": [
                                        {
                                          "name": "reccurrent",
                                          "source": "rec"
                                        
                                        }
                                      ],
                                            
                             "marks": [

                                         {
                                                              "type": "text",
                                                              "from": {"data": "reccurrent"},
                                                              "encode": {
                                                                "enter": {
                                                                  "fill": {"value": "#555555"},
                                                                  "text": {"field":"TOTAL"},
                                                                  "tooltip": {"signal": "{'District':datum.district_name,'Student Group':datum.SUBPOP,'% of all students in grade':datum.pct_total_subpop,'Records':datum.records}"},
                                                                    
                                                                    "fontSize":{"value":15},
                                                                     "align": {"value": "center"},
                                                                    "baseline": {"value": "middle"},
                                                                     "x":{"offset":-40 }
                                                                     
                                                              
                                                                  }
                                                                  }
                                                        }
                                        

                                                    ]

  }
        
  ],
  "scales": [
    {
      "name": "x",
      "type": "band",
      "domain": {
        "fields": [
          {"data": "data_1", "field": "grade"},
          {"data": "data_0", "field": "grade"}
        ],
        "sort": false
      },
      "range": {"step": {"signal": "x_step"}},
      "paddingInner": 0,
      "paddingOuter": 0
    },
    {
      "name": "y",
      "type": "band",
      "domain": {
        "fields": [
          {"data": "data_1", "field": "SUBPOP"},
          {"data": "data_0", "field": "SUBPOP"}
        ],
        "sort": true
      },
      "range": {"step": {"signal": "y_step"}},
      "paddingInner": 0,
      "paddingOuter": 0
    },
    {
      "name": "fill",
      "type":"log",
      "domain": {"data": "data_1", "field": "MSK_FNL2"},
      "range": {"scheme": {"signal": "palette"}},
      "interpolate": "hcl",
      "zero": false,
      "domainMax":11000000
    }
  ],
  "axes": [
    {
      "scale": "x",
      "orient": "top",
      "grid": true,
      "gridColor":"#666666",
      "title": "Grades",
      "labelAngle": 0,
      "labelBaseline": "middle",
      "labelColor":"#555555",
      "zindex": 5,
      "labelPadding":-22,
      "labelAlign":"center",
      "titlePadding":20,
      "bandPosition":1,
      "titleFont":10,
      "tickExtra":true,
      "labelFontSize":15,
      "tickSize":40
      
    },
    {
      "scale": "y",
      "orient": "left",
      "grid": true,
      "gridColor":"#666666",
      "zindex": 5,
      "labelPadding":0,
       "tickSize":185,
       "bandPosition":1,
       "tickExtra":true,
       "title": "Student Group",
        "titlePadding":0,  
        "titleFont":10,
        "labelFontSize":15,
        "titleAngle":0,
        "titleX":-180,
        "titleAlign":"left",
        "offset":0,
        "titleY":-10,
        "titleFontSize":12,
        "labelAlign":"left",
        "labelColor":"#666666",
        "titleColor":"#555555"
    },
     {
      "scale": "y",
      "orient": "top",
      "labels":false,      
       "bandPosition":1,
       "ticks": false,
       "tickExtra":true,
       "title": "Total",
        "titleFontWeight":"10",  
        "titleFontSize":15,
        "titleAngle":0,
        "titleX":-55,
        "titleY":-10,
        "tickSize":60,
        "titleColor":"#666666", 
        "titleAnchor":"start"       
    }
  ]
}
